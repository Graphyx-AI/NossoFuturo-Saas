# Guia de Internacionalização (i18n) — Nosso Futuro SaaS

Este guia descreve como o projeto está configurado para suportar múltiplos idiomas e como adicionar novas strings ou idiomas.

## Idiomas suportados

- **pt-BR** (padrão): Português (Brasil)
- **pt-PT**: Português (Portugal)
- **en**: Inglês
- **es**: Espanhol

## Estrutura de arquivos

```
messages/
  pt-BR.json   # Referência principal
  pt-PT.json   # Português Portugal
  en.json      # Inglês
  es.json      # Espanhol

src/
  i18n/
    routing.ts   # Configuração de locales e roteamento
    request.ts   # Carregamento de mensagens por locale
    navigation.ts # Link, useRouter, etc. com suporte a locale
```

## Roteamento e locale

- **URL**: O locale aparece no path quando não é o padrão (pt-BR). Ex.: `/en/dashboard`, `/pt-BR/login`.
- **Padrão**: pt-BR não exibe prefixo na URL (`/dashboard` em vez de `/pt-BR/dashboard`).
- **Cookie**: `NEXT_LOCALE` armazena a preferência do usuário (gerenciado pelo next-intl).

## Como adicionar uma nova string

1. Abra `messages/pt-BR.json` e adicione a chave no namespace adequado:
   ```json
   "forms": {
     "transaction": {
       "novaChave": "Texto em português"
     }
   }
   ```

2. No componente (Client Component):
   ```tsx
   import { useTranslations } from "next-intl";

   const t = useTranslations("forms.transaction");
   return <span>{t("novaChave")}</span>;
   ```

3. Em Server Component:
   ```tsx
   import { getTranslations } from "next-intl/server";

   const t = await getTranslations("forms.transaction");
   return <span>{t("novaChave")}</span>;
   ```

4. Com placeholders:
   ```tsx
   t("emailSent", { email: "user@example.com" });
   ```
   No JSON: `"emailSent": "Enviamos um link para {email}."`

5. Adicione a mesma chave em `messages/en.json`, `messages/es.json` e `messages/pt-PT.json`.

## Como adicionar um novo idioma

1. Edite `src/i18n/routing.ts`:
   ```ts
   locales: ["pt-BR", "pt-PT", "en", "es", "fr"],  // adicione "fr"
   ```

2. Crie `messages/fr.json` com a mesma estrutura de chaves de `pt-BR.json`.

3. Traduza os valores para o novo idioma.

## Navegação e links

Use o `Link` e `useRouter` do `@/i18n/navigation` para preservar o locale:

```tsx
import { Link, useRouter } from "@/i18n/navigation";

<Link href="/dashboard">Dashboard</Link>
// Com locale en, gera /en/dashboard
// Com locale pt-BR (padrão), gera /dashboard
```

## Formatação de datas e valores

- **Moeda**: `formatCurrency(cents, locale)` em `@/lib/utils/currency`
- **Data**: `formatDate(dateStr, locale)` em `@/lib/utils/dates`
- **pt-BR**: continue usando `formatBRL(cents)` quando o locale for fixo pt-BR

## Mapeamento de erros

Para erros das actions (ex.: "Não autorizado", "Workspace não encontrado"):

1. No cliente, em `catch`:
   ```tsx
   const tErrors = useTranslations("errors");
   if (err.message === "Não autorizado") {
     setError(tErrors("unauthorized"));
   } else {
     setError(err.message);
   }
   ```

2. As chaves de erro estão em `messages/*.json` em `errors.*`.

## Manutenção de copy

- **pt-BR**: arquivo de referência; é a base para novas chaves.
- **en, es, pt-PT**: traduções podem ser machine-translated e revisadas depois (marcar com `[REVIEW]` em comentários ou num doc).
- Os arquivos JSON devem ter as mesmas chaves em todos os locales; valores diferentes por idioma.

## Namespaces principais

| Namespace | Uso |
|-----------|-----|
| common | Brand, labels genéricos, meses |
| auth | Login, registro, recuperar senha |
| landing | Hero, features, planos, FAQ |
| nav | Sidebar, header |
| dashboard | Páginas do dashboard |
| forms | Formulários (transaction, goal, investment, etc.) |
| settings | Configurações, perfil, workspace |
| billing | Planos, assinatura |
| onboarding | Passos de onboarding |
| tour | Tour guiado |
| errors | Mensagens de erro |

## Referências

- [next-intl — Documentação](https://next-intl.dev/docs)
- [App Router Setup](https://next-intl.dev/docs/getting-started/app-router)
- [Routing](https://next-intl.dev/docs/routing)
